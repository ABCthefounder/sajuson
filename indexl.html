<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï†ïÎ∞Ä ÎßåÏÑ∏Î†• - ÏÇ¨Ï£º 8Í∏ÄÏûê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Î©îÏù∏ ÌéòÏù¥ÏßÄ */
        .main-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .input-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 100%;
        }

        .title {
            text-align: center;
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 1rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        /* Í≤∞Í≥º ÌéòÏù¥ÏßÄ */
        .result-page {
            display: none;
            min-height: 100vh;
            padding: 2rem;
        }

        .result-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .saju-display {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .person-info {
            margin-bottom: 2rem;
            color: #333;
        }

        .person-info h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .birth-info {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
        }

        .saju-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .pillars-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin: 2rem 0;
        }

        .pillar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem 1rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .pillar:hover {
            transform: translateY(-5px);
        }

        .pillar-title {
            font-size: 1rem;
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .pillar-chinese {
            font-size: 3rem;
            font-weight: bold;
            margin: 0.5rem 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            line-height: 1;
        }

        .pillar-korean {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .pillar-detail {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .summary-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .summary-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 1rem;
            text-align: center;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .info-item {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .calculation-time {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .pillars-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }

            .pillar-chinese {
                font-size: 2.5rem;
            }

            .input-container {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Î©îÏù∏ ÌéòÏù¥ÏßÄ -->
    <div id="mainPage" class="main-page">
        <div class="input-container">
            <h1 class="title">üîÆ ÎßåÏÑ∏Î†•</h1>
            <p class="subtitle">Ï†ïÌôïÌïú ÏÇ¨Ï£º 8Í∏ÄÏûêÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
            
            <form id="sajuForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ïù¥Î¶Ñ</label>
                        <input type="text" id="name" value="ÌôçÍ∏∏Îèô" required>
                    </div>
                    <div class="form-group">
                        <label>ÏÑ±Î≥Ñ</label>
                        <select id="gender" required>
                            <option value="male" selected>ÎÇ®Ïûê</option>
                            <option value="female">Ïó¨Ïûê</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ÏÉùÎÖÑÏõîÏùº</label>
                    <input type="date" id="birthDate" value="1990-05-15" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Îã¨Î†• Íµ¨Î∂Ñ</label>
                        <select id="calendarType" required>
                            <option value="solar" selected>ÏñëÎ†•</option>
                            <option value="lunar">ÏùåÎ†•</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ï∂úÏÉù ÏãúÍ∞Ñ</label>
                        <input type="time" id="birthTime" value="14:30" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Ï∂úÏÉù ÏßÄÏó≠</label>
                    <select id="location">
                        <option value="seoul" selected>ÏÑúÏö∏ÌäπÎ≥ÑÏãú</option>
                        <option value="busan">Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú</option>
                        <option value="daegu">ÎåÄÍµ¨Í¥ëÏó≠Ïãú</option>
                        <option value="incheon">Ïù∏Ï≤úÍ¥ëÏó≠Ïãú</option>
                        <option value="gwangju">Í¥ëÏ£ºÍ¥ëÏó≠Ïãú</option>
                        <option value="daejeon">ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú</option>
                        <option value="ulsan">Ïö∏ÏÇ∞Í¥ëÏó≠Ïãú</option>
                    </select>
                </div>
                
                <button type="submit" class="calculate-btn">
                    üßÆ ÎßåÏÑ∏Î†• Í≥ÑÏÇ∞ÌïòÍ∏∞
                </button>
            </form>
        </div>
    </div>

    <!-- Í≤∞Í≥º ÌéòÏù¥ÏßÄ -->
    <div id="resultPage" class="result-page">
        <div class="result-container">
            <button class="back-btn" onclick="goBack()">‚Üê Îã§Ïãú Í≥ÑÏÇ∞ÌïòÍ∏∞</button>
            
            <div class="header">
                <h1 id="resultTitle">ÏÇ¨Ï£ºÎ™ÖÎ∞ò</h1>
            </div>

            <div class="saju-display">
                <div class="person-info">
                    <h2 id="personName"></h2>
                    <div class="birth-info" id="birthInfo"></div>
                </div>

                <div class="saju-title">üìä ÏÇ¨Ï£º 8Í∏ÄÏûê</div>
                
                <div class="pillars-container" id="sajuResult">
                    <!-- ÏÇ¨Ï£º Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>

                <div class="summary-info">
                    <div class="summary-title">üåü ÏÇ¨Ï£º Ï†ïÎ≥¥</div>
                    <div class="info-grid" id="summaryInfo">
                        <!-- ÏöîÏïΩ Ï†ïÎ≥¥Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                </div>

                <div class="calculation-time" id="calculationTime">
                    <!-- Í≥ÑÏÇ∞ ÏãúÍ∞ÑÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ï†ïÎ∞Ä ÎßåÏÑ∏Î†• Í≥ÑÏÇ∞ ÏóîÏßÑ
        class PreciseManseCalculator {
            constructor() {
                // Ï≤úÍ∞Ñ 10Í∞ú
                this.heavenlyStems = [
                    { korean: 'Í∞ë', chinese: 'Áî≤', element: 'Î™©', yinyang: 'Ïñë' },
                    { korean: 'ÏùÑ', chinese: '‰πô', element: 'Î™©', yinyang: 'Ïùå' },
                    { korean: 'Î≥ë', chinese: '‰∏ô', element: 'Ìôî', yinyang: 'Ïñë' },
                    { korean: 'Ï†ï', chinese: '‰∏Å', element: 'Ìôî', yinyang: 'Ïùå' },
                    { korean: 'Î¨¥', chinese: 'Êàä', element: 'ÌÜ†', yinyang: 'Ïñë' },
                    { korean: 'Í∏∞', chinese: 'Â∑±', element: 'ÌÜ†', yinyang: 'Ïùå' },
                    { korean: 'Í≤Ω', chinese: 'Â∫ö', element: 'Í∏à', yinyang: 'Ïñë' },
                    { korean: 'Ïã†', chinese: 'Ëæõ', element: 'Í∏à', yinyang: 'Ïùå' },
                    { korean: 'ÏûÑ', chinese: 'Â£¨', element: 'Ïàò', yinyang: 'Ïñë' },
                    { korean: 'Í≥Ñ', chinese: 'Áô∏', element: 'Ïàò', yinyang: 'Ïùå' }
                ];

                // ÏßÄÏßÄ 12Í∞ú
                this.earthlyBranches = [
                    { korean: 'Ïûê', chinese: 'Â≠ê', animal: 'Ï•ê', time: '23-01Ïãú', element: 'Ïàò' },
                    { korean: 'Ï∂ï', chinese: '‰∏ë', animal: 'ÏÜå', time: '01-03Ïãú', element: 'ÌÜ†' },
                    { korean: 'Ïù∏', chinese: 'ÂØÖ', animal: 'Ìò∏ÎûëÏù¥', time: '03-05Ïãú', element: 'Î™©' },
                    { korean: 'Î¨ò', chinese: 'ÂçØ', animal: 'ÌÜ†ÎÅº', time: '05-07Ïãú', element: 'Î™©' },
                    { korean: 'ÏßÑ', chinese: 'Ëæ∞', animal: 'Ïö©', time: '07-09Ïãú', element: 'ÌÜ†' },
                    { korean: 'ÏÇ¨', chinese: 'Â∑≥', animal: 'Î±Ä', time: '09-11Ïãú', element: 'Ìôî' },
                    { korean: 'Ïò§', chinese: 'Âçà', animal: 'Îßê', time: '11-13Ïãú', element: 'Ìôî' },
                    { korean: 'ÎØ∏', chinese: 'Êú™', animal: 'Ïñë', time: '13-15Ïãú', element: 'ÌÜ†' },
                    { korean: 'Ïã†', chinese: 'Áî≥', animal: 'ÏõêÏà≠Ïù¥', time: '15-17Ïãú', element: 'Í∏à' },
                    { korean: 'Ïú†', chinese: 'ÈÖâ', animal: 'Îã≠', time: '17-19Ïãú', element: 'Í∏à' },
                    { korean: 'Ïà†', chinese: 'Êàå', animal: 'Í∞ú', time: '19-21Ïãú', element: 'ÌÜ†' },
                    { korean: 'Ìï¥', chinese: '‰∫•', animal: 'ÎèºÏßÄ', time: '21-23Ïãú', element: 'Ïàò' }
                ];

                // 2025ÎÖÑ Ï†ïÌôïÌïú 24Ï†àÍ∏∞ (ÌïúÍµ≠Ï≤úÎ¨∏Ïó∞Íµ¨Ïõê Í∏∞Ï§Ä)
                this.solarTerms2025 = {
                    ÏÜåÌïú: "2025-01-05 05:00",
                    ÎåÄÌïú: "2025-01-20 04:01",
                    ÏûÖÏ∂ò: "2025-02-03 22:10",
                    Ïö∞Ïàò: "2025-02-18 12:33",
                    Í≤ΩÏπ©: "2025-03-05 16:07",
                    Ï∂òÎ∂Ñ: "2025-03-20 15:01",
                    Ï≤≠Î™Ö: "2025-04-04 21:48",
                    Í≥°Ïö∞: "2025-04-20 03:55",
                    ÏûÖÌïò: "2025-05-05 09:10",
                    ÏÜåÎßå: "2025-05-20 21:59",
                    ÎßùÏ¢Ö: "2025-06-05 16:10",
                    ÌïòÏßÄ: "2025-06-21 10:42",
                    ÏÜåÏÑú: "2025-07-07 04:05",
                    ÎåÄÏÑú: "2025-07-22 21:30",
                    ÏûÖÏ∂î: "2025-08-07 14:09",
                    Ï≤òÏÑú: "2025-08-23 05:34",
                    Î∞±Î°ú: "2025-09-07 18:51",
                    Ï∂îÎ∂Ñ: "2025-09-23 06:19",
                    ÌïúÎ°ú: "2025-10-08 15:22",
                    ÏÉÅÍ∞ï: "2025-10-23 22:15",
                    ÏûÖÎèô: "2025-11-07 03:20",
                    ÏÜåÏÑ§: "2025-11-22 09:56",
                    ÎåÄÏÑ§: "2025-12-07 05:04",
                    ÎèôÏßÄ: "2025-12-21 22:21"
                };
            }

            // 60Í∞ëÏûê Í≥ÑÏÇ∞
            calculate60Gapja(stemIndex, branchIndex) {
                const stem = this.heavenlyStems[stemIndex];
                const branch = this.earthlyBranches[branchIndex];
                return {
                    korean: stem.korean + branch.korean,
                    chinese: stem.chinese + branch.chinese,
                    stem: stem,
                    branch: branch
                };
            }

            // Ï†ïÎ∞ÄÌïú ÎÖÑÏ£º Í≥ÑÏÇ∞ (ÏûÖÏ∂ò Í∏∞Ï§Ä)
            calculateYearPillar(year, month, day, hour, minute) {
                // ÏûÖÏ∂ò Ï†ÑÏù∏ÏßÄ ÌôïÏù∏
                const inputDateTime = new Date(year, month - 1, day, hour, minute);
                const lichunStr = year === 2025 ? this.solarTerms2025.ÏûÖÏ∂ò : `${year}-02-04 05:00`;
                const lichunDateTime = new Date(lichunStr);

                let sajuYear = year;
                if (inputDateTime < lichunDateTime) {
                    sajuYear = year - 1;
                }

                // 1984ÎÖÑ Í∞ëÏûêÎÖÑ Í∏∞Ï§ÄÏúºÎ°ú Í≥ÑÏÇ∞
                const baseYear = 1984;
                const yearDiff = sajuYear - baseYear;
                const stemIndex = ((yearDiff % 10) + 10) % 10;
                const branchIndex = ((yearDiff % 12) + 12) % 12;

                return this.calculate60Gapja(stemIndex, branchIndex);
            }

            // Ï†ïÌôïÌïú ÏõîÏ£º Í≥ÑÏÇ∞ (Ï†àÍ∏∞ Í∏∞Ï§Ä)
            calculateMonthPillar(year, month, day, yearStem) {
                // Ï†ïÌôïÌïú Ï†àÍ∏∞ Í∏∞Ï§ÄÏúºÎ°ú ÏõîÎ†π Í≤∞Ï†ï
                let monthBranchIndex;
                
                // Ï†àÍ∏∞Î≥Ñ ÏõîÎ†π Í≥ÑÏÇ∞ (ÏßÄÏßÄ Í∏∞Ï§Ä)
                if ((month === 1 && day >= 6) || (month === 2 && day < 4)) {
                    monthBranchIndex = 1; // Ï∂ïÏõî
                } else if ((month === 2 && day >= 4) || (month === 3 && day < 6)) {
                    monthBranchIndex = 2; // Ïù∏Ïõî  
                } else if ((month === 3 && day >= 6) || (month === 4 && day < 5)) {
                    monthBranchIndex = 3; // Î¨òÏõî ‚Üê 3Ïõî 9ÏùºÏùÄ Ïó¨Í∏∞!
                } else if ((month === 4 && day >= 5) || (month === 5 && day < 6)) {
                    monthBranchIndex = 4; // ÏßÑÏõî
                } else if ((month === 5 && day >= 6) || (month === 6 && day < 6)) {
                    monthBranchIndex = 5; // ÏÇ¨Ïõî
                } else if ((month === 6 && day >= 6) || (month === 7 && day < 7)) {
                    monthBranchIndex = 6; // Ïò§Ïõî
                } else if ((month === 7 && day >= 7) || (month === 8 && day < 8)) {
                    monthBranchIndex = 7; // ÎØ∏Ïõî  
                } else if ((month === 8 && day >= 8) || (month === 9 && day < 8)) {
                    monthBranchIndex = 8; // Ïã†Ïõî
                } else if ((month === 9 && day >= 8) || (month === 10 && day < 9)) {
                    monthBranchIndex = 9; // Ïú†Ïõî
                } else if ((month === 10 && day >= 9) || (month === 11 && day < 8)) {
                    monthBranchIndex = 10; // Ïà†Ïõî
                } else if ((month === 11 && day >= 8) || (month === 12 && day < 7)) {
                    monthBranchIndex = 11; // Ìï¥Ïõî
                } else { // (month === 12 && day >= 7) || (month === 1 && day < 6)
                    monthBranchIndex = 0; // ÏûêÏõî
                }

                // ÎÖÑÍ∞ÑÏóê Îî∞Î•∏ ÏõîÍ∞Ñ Ï≤úÍ∞Ñ Í≥ÑÏÇ∞
                const yearStemIndex = this.heavenlyStems.findIndex(s => s.chinese === yearStem.chinese);
                let monthStemBase;

                // Í∞ëÍ∏∞ÎÖÑ Î≥ëÏù∏Ïõî, ÏùÑÍ≤ΩÎÖÑ Î¨¥Ïù∏Ïõî, Î≥ëÏã†ÎÖÑ Í≤ΩÏù∏Ïõî, Ï†ïÏûÑÎÖÑ ÏûÑÏù∏Ïõî, Î¨¥Í≥ÑÎÖÑ Í∞ëÏù∏Ïõî
                if (yearStemIndex === 0 || yearStemIndex === 5) { // Í∞ëÎÖÑ, Í∏∞ÎÖÑ
                    monthStemBase = 2; // Î≥ë
                } else if (yearStemIndex === 1 || yearStemIndex === 6) { // ÏùÑÎÖÑ, Í≤ΩÎÖÑ
                    monthStemBase = 4; // Î¨¥
                } else if (yearStemIndex === 2 || yearStemIndex === 7) { // Î≥ëÎÖÑ, Ïã†ÎÖÑ
                    monthStemBase = 6; // Í≤Ω
                } else if (yearStemIndex === 3 || yearStemIndex === 8) { // Ï†ïÎÖÑ, ÏûÑÎÖÑ ‚Üê 1992ÎÖÑ ÏûÑÏã†ÎÖÑ
                    monthStemBase = 8; // ÏûÑ
                } else { // Î¨¥ÎÖÑ, Í≥ÑÎÖÑ
                    monthStemBase = 0; // Í∞ë
                }

                // Ïù∏Ïõî(2)ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Ï≤úÍ∞Ñ Í≥ÑÏÇ∞
                let monthOffset = monthBranchIndex - 2; // Ïù∏ÏõîÏùÑ 0ÏúºÎ°ú Í∏∞Ï§Ä
                if (monthOffset < 0) monthOffset += 12;
                
                const monthStemIndex = (monthStemBase + monthOffset) % 10;

                return this.calculate60Gapja(monthStemIndex, monthBranchIndex);
            }

            // Í≤ÄÏ¶ùÎêú ÏùºÏ£º Í≥ÑÏÇ∞ (Ï†ïÌôïÌïú Í∏∞Ï§ÄÏùº ÏÇ¨Ïö©)
            calculateDayPillar(year, month, day) {
                // Í≤ÄÏ¶ùÎêú Í∏∞Ï§ÄÏùº: 1900ÎÖÑ 1Ïõî 1Ïùº = Í≤ΩÏßÑÏùº (Ï≤úÍ∞Ñ6, ÏßÄÏßÄ4)
                let totalDays = 0;
                
                // 1900ÎÖÑÎ∂ÄÌÑ∞ Ìï¥Îãπ Ïó∞ÎèÑ Ï†ÑÎÖÑÍπåÏßÄÏùò Ï¥ù ÏùºÏàò
                for (let y = 1900; y < year; y++) {
                    if (this.isLeapYear(y)) {
                        totalDays += 366;
                    } else {
                        totalDays += 365;
                    }
                }
                
                // Ìï¥Îãπ Ïó∞ÎèÑÏùò 1Ïõî 1ÏùºÎ∂ÄÌÑ∞ Ìï¥Îãπ ÏõîÏùºÍπåÏßÄÏùò ÏùºÏàò
                const daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                if (this.isLeapYear(year)) {
                    daysInMonth[1] = 29; // Ïú§ÎÖÑ 2Ïõî
                }
                
                for (let m = 1; m < month; m++) {
                    totalDays += daysInMonth[m - 1];
                }
                totalDays += day - 1; // Ìï¥Îãπ Ïùº (0Î∂ÄÌÑ∞ ÏãúÏûë)

                // 1900ÎÖÑ 1Ïõî 1ÏùºÏù¥ Í≤ΩÏßÑÏùº (Ï≤úÍ∞Ñ 6, ÏßÄÏßÄ 4)
                const baseStem = 6; // Í≤Ω
                const baseBranch = 4; // ÏßÑ
                
                const stemIndex = (baseStem + totalDays) % 10;
                const branchIndex = (baseBranch + totalDays) % 12;
                
                return this.calculate60Gapja(stemIndex, branchIndex);
            }

            // Ïú§ÎÖÑ ÌåêÎ≥Ñ
            isLeapYear(year) {
                return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
            }

            // Ï†ïÌôïÌïú ÏãúÏ£º Í≥ÑÏÇ∞
            calculateTimePillar(hour, minute, dayStem) {
                // ÌÉúÏñëÏãú Î≥¥Ï†ï (ÌïúÍµ≠ Í∏∞Ï§Ä ÏïΩ 30Î∂Ñ Ï∞®Ïù¥)
                let correctedHour = hour;
                let correctedMinute = minute - 30;
                
                if (correctedMinute < 0) {
                    correctedMinute += 60;
                    correctedHour -= 1;
                }
                
                if (correctedHour < 0) {
                    correctedHour += 24;
                }

                // ÏïºÏûêÏãú Í∏∞Ï§Ä Ï†ÅÏö© (23:30 Ïù¥ÌõÑÎäî Îã§ÏùåÎÇ†)
                if (correctedHour >= 23 && correctedMinute >= 30) {
                    correctedHour = 0; // Îã§ÏùåÎÇ† ÏûêÏãúÎ°ú Ï≤òÎ¶¨
                }

                // 12ÏßÄÏãú Í≤∞Ï†ï
                let branchIndex;
                if (correctedHour >= 23 || correctedHour < 1) branchIndex = 0; // ÏûêÏãú
                else if (correctedHour >= 1 && correctedHour < 3) branchIndex = 1;  // Ï∂ïÏãú
                else if (correctedHour >= 3 && correctedHour < 5) branchIndex = 2;  // Ïù∏Ïãú
                else if (correctedHour >= 5 && correctedHour < 7) branchIndex = 3;  // Î¨òÏãú
                else if (correctedHour >= 7 && correctedHour < 9) branchIndex = 4;  // ÏßÑÏãú
                else if (correctedHour >= 9 && correctedHour < 11) branchIndex = 5; // ÏÇ¨Ïãú
                else if (correctedHour >= 11 && correctedHour < 13) branchIndex = 6; // Ïò§Ïãú
                else if (correctedHour >= 13 && correctedHour < 15) branchIndex = 7; // ÎØ∏Ïãú
                else if (correctedHour >= 15 && correctedHour < 17) branchIndex = 8; // Ïã†Ïãú
                else if (correctedHour >= 17 && correctedHour < 19) branchIndex = 9; // Ïú†Ïãú
                else if (correctedHour >= 19 && correctedHour < 21) branchIndex = 10; // Ïà†Ïãú
                else branchIndex = 11; // Ìï¥Ïãú

                // ÏùºÍ∞ÑÎ≥Ñ ÏãúÏûë Ï≤úÍ∞Ñ Í≤∞Ï†ï
                const dayStemIndex = this.heavenlyStems.findIndex(s => s.chinese === dayStem.chinese);
                let baseTimeStem;

                // Í∞ëÍ∏∞Ïùº Í∞ëÏûêÏãú, ÏùÑÍ≤ΩÏùº Î≥ëÏûêÏãú, Î≥ëÏã†Ïùº Î¨¥ÏûêÏãú, Ï†ïÏûÑÏùº Í≤ΩÏûêÏãú, Î¨¥Í≥ÑÏùº ÏûÑÏûêÏãú
                if (dayStemIndex === 0 || dayStemIndex === 5) baseTimeStem = 0; // Í∞ë
                else if (dayStemIndex === 1 || dayStemIndex === 6) baseTimeStem = 2; // Î≥ë  
                else if (dayStemIndex === 2 || dayStemIndex === 7) baseTimeStem = 4; // Î¨¥
                else if (dayStemIndex === 3 || dayStemIndex === 8) baseTimeStem = 6; // Í≤Ω
                else baseTimeStem = 8; // ÏûÑ

                // ÏãúÍ∞Ñ Ï≤úÍ∞Ñ Í≥ÑÏÇ∞ (ÏßÄÏßÄÎßàÎã§ Ï≤úÍ∞Ñ 1Ïî© Ï¶ùÍ∞Ä)
                const timeStemIndex = (baseTimeStem + branchIndex) % 10;

                return this.calculate60Gapja(timeStemIndex, branchIndex);
            }

            // Ï†ÑÏ≤¥ ÏÇ¨Ï£º Í≥ÑÏÇ∞
            calculateSaju(birthData) {
                const { year, month, day, hour, minute } = birthData;

                const yearPillar = this.calculateYearPillar(year, month, day, hour, minute);
                const monthPillar = this.calculateMonthPillar(year, month, day, yearPillar.stem);
                const dayPillar = this.calculateDayPillar(year, month, day);
                const timePillar = this.calculateTimePillar(hour, minute, dayPillar.stem);

                return {
                    year: yearPillar,
                    month: monthPillar,
                    day: dayPillar,
                    time: timePillar
                };
            }
        }

        // Ï†ÑÏó≠ Î≥ÄÏàò
        const calculator = new PreciseManseCalculator();

        // Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨
        document.getElementById('sajuForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const gender = document.getElementById('gender').value;
            const birthDate = new Date(document.getElementById('birthDate').value);
            const birthTime = document.getElementById('birthTime').value;
            const calendarType = document.getElementById('calendarType').value;
            const location = document.getElementById('location').value;

            const [hour, minute] = birthTime.split(':').map(Number);

            const birthData = {
                name: name,
                gender: gender,
                year: birthDate.getFullYear(),
                month: birthDate.getMonth() + 1,
                day: birthDate.getDate(),
                hour: hour,
                minute: minute,
                calendarType: calendarType,
                location: location
            };

            // ÏÇ¨Ï£º Í≥ÑÏÇ∞
            const saju = calculator.calculateSaju(birthData);
            
            // Í≤∞Í≥º ÌéòÏù¥ÏßÄ ÌëúÏãú
            showResult(birthData, saju);
        });

        // Í≤∞Í≥º ÌéòÏù¥ÏßÄ ÌëúÏãú
        function showResult(birthData, saju) {
            // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('resultPage').style.display = 'block';

            // Í∞úÏù∏ Ï†ïÎ≥¥ ÌëúÏãú
            document.getElementById('personName').textContent = birthData.name + 'Îãò';
            
            const birthInfo = `
                ${birthData.year}ÎÖÑ ${birthData.month}Ïõî ${birthData.day}Ïùº 
                ${String(birthData.hour).padStart(2, '0')}:${String(birthData.minute).padStart(2, '0')} 
                (${birthData.gender === 'male' ? 'ÎÇ®ÏÑ±' : 'Ïó¨ÏÑ±'}, ${birthData.calendarType === 'solar' ? 'ÏñëÎ†•' : 'ÏùåÎ†•'})
            `;
            document.getElementById('birthInfo').textContent = birthInfo;

            // ÏÇ¨Ï£º 8Í∏ÄÏûê ÌëúÏãú
            const pillars = [
                { title: 'ÎÖÑÏ£º (Âπ¥)', pillar: saju.year, info: `${saju.year.branch.animal}Îù†` },
                { title: 'ÏõîÏ£º (Êúà)', pillar: saju.month, info: `${saju.month.branch.time}` },
                { title: 'ÏùºÏ£º (Êó•)', pillar: saju.day, info: 'ÏùºÍ∞Ñ (Î≥∏Ïù∏)' },
                { title: 'ÏãúÏ£º (ÊôÇ)', pillar: saju.time, info: `${saju.time.branch.time}` }
            ];

            const sajuHTML = pillars.map(item => `
                <div class="pillar">
                    <div class="pillar-title">${item.title}</div>
                    <div class="pillar-chinese">${item.pillar.chinese}</div>
                    <div class="pillar-korean">${item.pillar.korean}</div>
                    <div class="pillar-detail">
                        ${item.pillar.stem.element}${item.pillar.stem.yinyang} / ${item.pillar.branch.element}<br>
                        ${item.info}
                    </div>
                </div>
            `).join('');

            document.getElementById('sajuResult').innerHTML = sajuHTML;

            // ÏöîÏïΩ Ï†ïÎ≥¥ ÌëúÏãú
            const summaryHTML = `
                <div class="info-item">
                    <div class="info-label">ÏùºÍ∞Ñ (Î≥∏Ïù∏)</div>
                    <div class="info-value">${saju.day.stem.chinese} (${saju.day.stem.element}${saju.day.stem.yinyang})</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Îù†</div>
                    <div class="info-value">${saju.year.branch.animal}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Ï∂úÏÉù Í≥ÑÏ†à</div>
                    <div class="info-value">${getSeasonFromMonth(birthData.month)}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ÌòÑÏû¨ ÎÇòÏù¥</div>
                    <div class="info-value">${new Date().getFullYear() - birthData.year + 1}ÏÑ∏</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ÏÇ¨Ï£º 8Í∏ÄÏûê</div>
                    <div class="info-value">${saju.year.chinese}${saju.month.chinese}${saju.day.chinese}${saju.time.chinese}</div>
                </div>
            `;

            document.getElementById('summaryInfo').innerHTML = summaryHTML;
            document.getElementById('calculationTime').textContent = 
                `Í≥ÑÏÇ∞ ÏôÑÎ£å: ${new Date().toLocaleString()}`;

            // Í≤∞Í≥º ÌéòÏù¥ÏßÄÎ°ú Ïä§ÌÅ¨Î°§
            window.scrollTo(0, 0);
        }

        // Í≥ÑÏ†à Í≥ÑÏÇ∞
        function getSeasonFromMonth(month) {
            if (month >= 3 && month <= 5) return 'Î¥Ñ';
            if (month >= 6 && month <= 8) return 'Ïó¨Î¶Ñ';  
            if (month >= 9 && month <= 11) return 'Í∞ÄÏùÑ';
            return 'Í≤®Ïö∏';
        }

        // Îí§Î°ú Í∞ÄÍ∏∞
        function goBack() {
            document.getElementById('mainPage').style.display = 'flex';
            document.getElementById('resultPage').style.display = 'none';
        }

        // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
        window.addEventListener('load', function() {
            const today = new Date();
            document.getElementById('birthDate').valueAsDate = today;
        });
    </script>
</body>
</html>
