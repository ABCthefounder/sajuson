<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë°€ ë§Œì„¸ë ¥ - ì‚¬ì£¼ 8ê¸€ì</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* ë©”ì¸ í˜ì´ì§€ */
        .main-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .input-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 100%;
        }

        .title {
            text-align: center;
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 1rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        /* ê²°ê³¼ í˜ì´ì§€ */
        .result-page {
            display: none;
            min-height: 100vh;
            padding: 2rem;
        }

        .result-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .saju-display {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .person-info {
            margin-bottom: 2rem;
            color: #333;
        }

        .person-info h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .birth-info {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
        }

        .saju-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .pillars-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin: 2rem 0;
        }

        .pillar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem 1rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .pillar:hover {
            transform: translateY(-5px);
        }

        .pillar-title {
            font-size: 1rem;
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .pillar-chinese {
            font-size: 3rem;
            font-weight: bold;
            margin: 0.5rem 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            line-height: 1;
        }

        .pillar-korean {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .pillar-detail {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .summary-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .summary-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 1rem;
            text-align: center;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .info-item {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .calculation-time {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .pillars-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }

            .pillar-chinese {
                font-size: 2.5rem;
            }

            .input-container {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- ë©”ì¸ í˜ì´ì§€ -->
    <div id="mainPage" class="main-page">
        <div class="input-container">
            <h1 class="title">ğŸ”® ë§Œì„¸ë ¥</h1>
            <p class="subtitle">ì •í™•í•œ ì‚¬ì£¼ 8ê¸€ìë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            
            <form id="sajuForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ì´ë¦„</label>
                        <input type="text" id="name" value="í™ê¸¸ë™" required>
                    </div>
                    <div class="form-group">
                        <label>ì„±ë³„</label>
                        <select id="gender" required>
                            <option value="male" selected>ë‚¨ì</option>
                            <option value="female">ì—¬ì</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ìƒë…„ì›”ì¼</label>
                    <input type="date" id="birthDate" value="1990-05-15" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ë‹¬ë ¥ êµ¬ë¶„</label>
                        <select id="calendarType" required>
                            <option value="solar" selected>ì–‘ë ¥</option>
                            <option value="lunar">ìŒë ¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ì¶œìƒ ì‹œê°„</label>
                        <input type="time" id="birthTime" value="14:30" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ì¶œìƒ ì§€ì—­</label>
                    <select id="location">
                        <option value="seoul" selected>ì„œìš¸íŠ¹ë³„ì‹œ</option>
                        <option value="busan">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                        <option value="daegu">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                        <option value="incheon">ì¸ì²œê´‘ì—­ì‹œ</option>
                        <option value="gwangju">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                        <option value="daejeon">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                        <option value="ulsan">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                    </select>
                </div>
                
                <button type="submit" class="calculate-btn">
                    ğŸ§® ë§Œì„¸ë ¥ ê³„ì‚°í•˜ê¸°
                </button>
            </form>
        </div>
    </div>

    <!-- ê²°ê³¼ í˜ì´ì§€ -->
    <div id="resultPage" class="result-page">
        <div class="result-container">
            <button class="back-btn" onclick="goBack()">â† ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°</button>
            
            <div class="header">
                <h1 id="resultTitle">ì‚¬ì£¼ëª…ë°˜</h1>
            </div>

            <div class="saju-display">
                <div class="person-info">
                    <h2 id="personName"></h2>
                    <div class="birth-info" id="birthInfo"></div>
                </div>

                <div class="saju-title">ğŸ“Š ì‚¬ì£¼ 8ê¸€ì</div>
                
                <div class="pillars-container" id="sajuResult">
                    <!-- ì‚¬ì£¼ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>

                <div class="summary-info">
                    <div class="summary-title">ğŸŒŸ ì‚¬ì£¼ ì •ë³´</div>
                    <div class="info-grid" id="summaryInfo">
                        <!-- ìš”ì•½ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <div class="calculation-time" id="calculationTime">
                    <!-- ê³„ì‚° ì‹œê°„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì •ë°€ ë§Œì„¸ë ¥ ê³„ì‚° ì—”ì§„
        class PreciseManseCalculator {
            constructor() {
                // ì²œê°„ 10ê°œ
                this.heavenlyStems = [
                    { korean: 'ê°‘', chinese: 'ç”²', element: 'ëª©', yinyang: 'ì–‘' },
                    { korean: 'ì„', chinese: 'ä¹™', element: 'ëª©', yinyang: 'ìŒ' },
                    { korean: 'ë³‘', chinese: 'ä¸™', element: 'í™”', yinyang: 'ì–‘' },
                    { korean: 'ì •', chinese: 'ä¸', element: 'í™”', yinyang: 'ìŒ' },
                    { korean: 'ë¬´', chinese: 'æˆŠ', element: 'í† ', yinyang: 'ì–‘' },
                    { korean: 'ê¸°', chinese: 'å·±', element: 'í† ', yinyang: 'ìŒ' },
                    { korean: 'ê²½', chinese: 'åºš', element: 'ê¸ˆ', yinyang: 'ì–‘' },
                    { korean: 'ì‹ ', chinese: 'è¾›', element: 'ê¸ˆ', yinyang: 'ìŒ' },
                    { korean: 'ì„', chinese: 'å£¬', element: 'ìˆ˜', yinyang: 'ì–‘' },
                    { korean: 'ê³„', chinese: 'ç™¸', element: 'ìˆ˜', yinyang: 'ìŒ' }
                ];

                // ì§€ì§€ 12ê°œ
                this.earthlyBranches = [
                    { korean: 'ì', chinese: 'å­', animal: 'ì¥', time: '23-01ì‹œ', element: 'ìˆ˜' },
                    { korean: 'ì¶•', chinese: 'ä¸‘', animal: 'ì†Œ', time: '01-03ì‹œ', element: 'í† ' },
                    { korean: 'ì¸', chinese: 'å¯…', animal: 'í˜¸ë‘ì´', time: '03-05ì‹œ', element: 'ëª©' },
                    { korean: 'ë¬˜', chinese: 'å¯', animal: 'í† ë¼', time: '05-07ì‹œ', element: 'ëª©' },
                    { korean: 'ì§„', chinese: 'è¾°', animal: 'ìš©', time: '07-09ì‹œ', element: 'í† ' },
                    { korean: 'ì‚¬', chinese: 'å·³', animal: 'ë±€', time: '09-11ì‹œ', element: 'í™”' },
                    { korean: 'ì˜¤', chinese: 'åˆ', animal: 'ë§', time: '11-13ì‹œ', element: 'í™”' },
                    { korean: 'ë¯¸', chinese: 'æœª', animal: 'ì–‘', time: '13-15ì‹œ', element: 'í† ' },
                    { korean: 'ì‹ ', chinese: 'ç”³', animal: 'ì›ìˆ­ì´', time: '15-17ì‹œ', element: 'ê¸ˆ' },
                    { korean: 'ìœ ', chinese: 'é…‰', animal: 'ë‹­', time: '17-19ì‹œ', element: 'ê¸ˆ' },
                    { korean: 'ìˆ ', chinese: 'æˆŒ', animal: 'ê°œ', time: '19-21ì‹œ', element: 'í† ' },
                    { korean: 'í•´', chinese: 'äº¥', animal: 'ë¼ì§€', time: '21-23ì‹œ', element: 'ìˆ˜' }
                ];

                // 2025ë…„ ì •í™•í•œ 24ì ˆê¸° (í•œêµ­ì²œë¬¸ì—°êµ¬ì› ê¸°ì¤€)
                this.solarTerms2025 = {
                    ì†Œí•œ: "2025-01-05 05:00",
                    ëŒ€í•œ: "2025-01-20 04:01",
                    ì…ì¶˜: "2025-02-03 22:10",
                    ìš°ìˆ˜: "2025-02-18 12:33",
                    ê²½ì¹©: "2025-03-05 16:07",
                    ì¶˜ë¶„: "2025-03-20 15:01",
                    ì²­ëª…: "2025-04-04 21:48",
                    ê³¡ìš°: "2025-04-20 03:55",
                    ì…í•˜: "2025-05-05 09:10",
                    ì†Œë§Œ: "2025-05-20 21:59",
                    ë§ì¢…: "2025-06-05 16:10",
                    í•˜ì§€: "2025-06-21 10:42",
                    ì†Œì„œ: "2025-07-07 04:05",
                    ëŒ€ì„œ: "2025-07-22 21:30",
                    ì…ì¶”: "2025-08-07 14:09",
                    ì²˜ì„œ: "2025-08-23 05:34",
                    ë°±ë¡œ: "2025-09-07 18:51",
                    ì¶”ë¶„: "2025-09-23 06:19",
                    í•œë¡œ: "2025-10-08 15:22",
                    ìƒê°•: "2025-10-23 22:15",
                    ì…ë™: "2025-11-07 03:20",
                    ì†Œì„¤: "2025-11-22 09:56",
                    ëŒ€ì„¤: "2025-12-07 05:04",
                    ë™ì§€: "2025-12-21 22:21"
                };
            }

            // 60ê°‘ì ê³„ì‚°
            calculate60Gapja(stemIndex, branchIndex) {
                const stem = this.heavenlyStems[stemIndex];
                const branch = this.earthlyBranches[branchIndex];
                return {
                    korean: stem.korean + branch.korean,
                    chinese: stem.chinese + branch.chinese,
                    stem: stem,
                    branch: branch
                };
            }

            // ì •ë°€í•œ ë…„ì£¼ ê³„ì‚° (ì…ì¶˜ ê¸°ì¤€)
            calculateYearPillar(year, month, day, hour, minute) {
                // ì…ì¶˜ ì „ì¸ì§€ í™•ì¸
                const inputDateTime = new Date(year, month - 1, day, hour, minute);
                const lichunStr = year === 2025 ? this.solarTerms2025.ì…ì¶˜ : `${year}-02-04 05:00`;
                const lichunDateTime = new Date(lichunStr);

                let sajuYear = year;
                if (inputDateTime < lichunDateTime) {
                    sajuYear = year - 1;
                }

                // 1984ë…„ ê°‘ìë…„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
                const baseYear = 1984;
                const yearDiff = sajuYear - baseYear;
                const stemIndex = ((yearDiff % 10) + 10) % 10;
                const branchIndex = ((yearDiff % 12) + 12) % 12;

                return this.calculate60Gapja(stemIndex, branchIndex);
            }

            // ì •í™•í•œ ì›”ì£¼ ê³„ì‚° (ì ˆê¸° ê¸°ì¤€)
            calculateMonthPillar(year, month, day, yearStem) {
                // ì •í™•í•œ ì ˆê¸° ê¸°ì¤€ìœ¼ë¡œ ì›”ë ¹ ê²°ì •
                let monthBranchIndex;
                
                // ì ˆê¸°ë³„ ì›”ë ¹ ê³„ì‚° (ì§€ì§€ ê¸°ì¤€)
                if ((month === 1 && day >= 6) || (month === 2 && day < 4)) {
                    monthBranchIndex = 1; // ì¶•ì›”
                } else if ((month === 2 && day >= 4) || (month === 3 && day < 6)) {
                    monthBranchIndex = 2; // ì¸ì›”  
                } else if ((month === 3 && day >= 6) || (month === 4 && day < 5)) {
                    monthBranchIndex = 3; // ë¬˜ì›” â† 3ì›” 9ì¼ì€ ì—¬ê¸°!
                } else if ((month === 4 && day >= 5) || (month === 5 && day < 6)) {
                    monthBranchIndex = 4; // ì§„ì›”
                } else if ((month === 5 && day >= 6) || (month === 6 && day < 6)) {
                    monthBranchIndex = 5; // ì‚¬ì›”
                } else if ((month === 6 && day >= 6) || (month === 7 && day < 7)) {
                    monthBranchIndex = 6; // ì˜¤ì›”
                } else if ((month === 7 && day >= 7) || (month === 8 && day < 8)) {
                    monthBranchIndex = 7; // ë¯¸ì›”  
                } else if ((month === 8 && day >= 8) || (month === 9 && day < 8)) {
                    monthBranchIndex = 8; // ì‹ ì›”
                } else if ((month === 9 && day >= 8) || (month === 10 && day < 9)) {
                    monthBranchIndex = 9; // ìœ ì›”
                } else if ((month === 10 && day >= 9) || (month === 11 && day < 8)) {
                    monthBranchIndex = 10; // ìˆ ì›”
                } else if ((month === 11 && day >= 8) || (month === 12 && day < 7)) {
                    monthBranchIndex = 11; // í•´ì›”
                } else { // (month === 12 && day >= 7) || (month === 1 && day < 6)
                    monthBranchIndex = 0; // ìì›”
                }

                // ë…„ê°„ì— ë”°ë¥¸ ì›”ê°„ ì²œê°„ ê³„ì‚°
                const yearStemIndex = this.heavenlyStems.findIndex(s => s.chinese === yearStem.chinese);
                let monthStemBase;

                // ê°‘ê¸°ë…„ ë³‘ì¸ì›”, ì„ê²½ë…„ ë¬´ì¸ì›”, ë³‘ì‹ ë…„ ê²½ì¸ì›”, ì •ì„ë…„ ì„ì¸ì›”, ë¬´ê³„ë…„ ê°‘ì¸ì›”
                if (yearStemIndex === 0 || yearStemIndex === 5) { // ê°‘ë…„, ê¸°ë…„
                    monthStemBase = 2; // ë³‘
                } else if (yearStemIndex === 1 || yearStemIndex === 6) { // ì„ë…„, ê²½ë…„
                    monthStemBase = 4; // ë¬´
                } else if (yearStemIndex === 2 || yearStemIndex === 7) { // ë³‘ë…„, ì‹ ë…„
                    monthStemBase = 6; // ê²½
                } else if (yearStemIndex === 3 || yearStemIndex === 8) { // ì •ë…„, ì„ë…„ â† 1992ë…„ ì„ì‹ ë…„
                    monthStemBase = 8; // ì„
                } else { // ë¬´ë…„, ê³„ë…„
                    monthStemBase = 0; // ê°‘
                }

                // ì¸ì›”(2)ì„ ê¸°ì¤€ìœ¼ë¡œ ì²œê°„ ê³„ì‚°
                let monthOffset = monthBranchIndex - 2; // ì¸ì›”ì„ 0ìœ¼ë¡œ ê¸°ì¤€
                if (monthOffset < 0) monthOffset += 12;
                
                const monthStemIndex = (monthStemBase + monthOffset) % 10;

                return this.calculate60Gapja(monthStemIndex, monthBranchIndex);
            }

            // ê²€ì¦ëœ ì¼ì£¼ ê³„ì‚° (ì •í™•í•œ ê¸°ì¤€ì¼ ì‚¬ìš©)
            calculateDayPillar(year, month, day) {
                // ê²€ì¦ëœ ê¸°ì¤€ì¼: 1900ë…„ 1ì›” 1ì¼ = ê²½ì§„ì¼ (ì²œê°„6, ì§€ì§€4)
                let totalDays = 0;
                
                // 1900ë…„ë¶€í„° í•´ë‹¹ ì—°ë„ ì „ë…„ê¹Œì§€ì˜ ì´ ì¼ìˆ˜
                for (let y = 1900; y < year; y++) {
                    if (this.isLeapYear(y)) {
                        totalDays += 366;
                    } else {
                        totalDays += 365;
                    }
                }
                
                // í•´ë‹¹ ì—°ë„ì˜ 1ì›” 1ì¼ë¶€í„° í•´ë‹¹ ì›”ì¼ê¹Œì§€ì˜ ì¼ìˆ˜
                const daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                if (this.isLeapYear(year)) {
                    daysInMonth[1] = 29; // ìœ¤ë…„ 2ì›”
                }
                
                for (let m = 1; m < month; m++) {
                    totalDays += daysInMonth[m - 1];
                }
                totalDays += day - 1; // í•´ë‹¹ ì¼ (0ë¶€í„° ì‹œì‘)

                // 1900ë…„ 1ì›” 1ì¼ì´ ê²½ì§„ì¼ (ì²œê°„ 6, ì§€ì§€ 4)
                const baseStem = 6; // ê²½
                const baseBranch = 4; // ì§„
                
                const stemIndex = (baseStem + totalDays) % 10;
                const branchIndex = (baseBranch + totalDays) % 12;
                
                return this.calculate60Gapja(stemIndex, branchIndex);
            }

            // ìœ¤ë…„ íŒë³„
            isLeapYear(year) {
                return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
            }

            // ì •í™•í•œ ì‹œì£¼ ê³„ì‚°
            calculateTimePillar(hour, minute, dayStem) {
                // íƒœì–‘ì‹œ ë³´ì • (í•œêµ­ ê¸°ì¤€ ì•½ 30ë¶„ ì°¨ì´)
                let correctedHour = hour;
                let correctedMinute = minute - 30;
                
                if (correctedMinute < 0) {
                    correctedMinute += 60;
                    correctedHour -= 1;
                }
                
                if (correctedHour < 0) {
                    correctedHour += 24;
                }

                // ì•¼ìì‹œ ê¸°ì¤€ ì ìš© (23:30 ì´í›„ëŠ” ë‹¤ìŒë‚ )
                if (correctedHour >= 23 && correctedMinute >= 30) {
                    correctedHour = 0; // ë‹¤ìŒë‚  ìì‹œë¡œ ì²˜ë¦¬
                }

                // 12ì§€ì‹œ ê²°ì •
                let branchIndex;
                if (correctedHour >= 23 || correctedHour < 1) branchIndex = 0; // ìì‹œ
                else if (correctedHour >= 1 && correctedHour < 3) branchIndex = 1;  // ì¶•ì‹œ
                else if (correctedHour >= 3 && correctedHour < 5) branchIndex = 2;  // ì¸ì‹œ
                else if (correctedHour >= 5 && correctedHour < 7) branchIndex = 3;  // ë¬˜ì‹œ
                else if (correctedHour >= 7 && correctedHour < 9) branchIndex = 4;  // ì§„ì‹œ
                else if (correctedHour >= 9 && correctedHour < 11) branchIndex = 5; // ì‚¬ì‹œ
                else if (correctedHour >= 11 && correctedHour < 13) branchIndex = 6; // ì˜¤ì‹œ
                else if (correctedHour >= 13 && correctedHour < 15) branchIndex = 7; // ë¯¸ì‹œ
                else if (correctedHour >= 15 && correctedHour < 17) branchIndex = 8; // ì‹ ì‹œ
                else if (correctedHour >= 17 && correctedHour < 19) branchIndex = 9; // ìœ ì‹œ
                else if (correctedHour >= 19 && correctedHour < 21) branchIndex = 10; // ìˆ ì‹œ
                else branchIndex = 11; // í•´ì‹œ

                // ì¼ê°„ë³„ ì‹œì‘ ì²œê°„ ê²°ì •
                const dayStemIndex = this.heavenlyStems.findIndex(s => s.chinese === dayStem.chinese);
                let baseTimeStem;

                // ê°‘ê¸°ì¼ ê°‘ìì‹œ, ì„ê²½ì¼ ë³‘ìì‹œ, ë³‘ì‹ ì¼ ë¬´ìì‹œ, ì •ì„ì¼ ê²½ìì‹œ, ë¬´ê³„ì¼ ì„ìì‹œ
                if (dayStemIndex === 0 || dayStemIndex === 5) baseTimeStem = 0; // ê°‘
                else if (dayStemIndex === 1 || dayStemIndex === 6) baseTimeStem = 2; // ë³‘  
                else if (dayStemIndex === 2 || dayStemIndex === 7) baseTimeStem = 4; // ë¬´
                else if (dayStemIndex === 3 || dayStemIndex === 8) baseTimeStem = 6; // ê²½
                else baseTimeStem = 8; // ì„

                // ì‹œê°„ ì²œê°„ ê³„ì‚° (ì§€ì§€ë§ˆë‹¤ ì²œê°„ 1ì”© ì¦ê°€)
                const timeStemIndex = (baseTimeStem + branchIndex) % 10;

                return this.calculate60Gapja(timeStemIndex, branchIndex);
            }

            // ì „ì²´ ì‚¬ì£¼ ê³„ì‚°
            calculateSaju(birthData) {
                const { year, month, day, hour, minute } = birthData;

                const yearPillar = this.calculateYearPillar(year, month, day, hour, minute);
                const monthPillar = this.calculateMonthPillar(year, month, day, yearPillar.stem);
                const dayPillar = this.calculateDayPillar(year, month, day);
                const timePillar = this.calculateTimePillar(hour, minute, dayPillar.stem);

                return {
                    year: yearPillar,
                    month: monthPillar,
                    day: dayPillar,
                    time: timePillar
                };
            }
        }

        // ì „ì—­ ë³€ìˆ˜
        const calculator = new PreciseManseCalculator();

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('sajuForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const gender = document.getElementById('gender').value;
            const birthDate = new Date(document.getElementById('birthDate').value);
            const birthTime = document.getElementById('birthTime').value;
            const calendarType = document.getElementById('calendarType').value;
            const location = document.getElementById('location').value;

            const [hour, minute] = birthTime.split(':').map(Number);

            const birthData = {
                name: name,
                gender: gender,
                year: birthDate.getFullYear(),
                month: birthDate.getMonth() + 1,
                day: birthDate.getDate(),
                hour: hour,
                minute: minute,
                calendarType: calendarType,
                location: location
            };

            // ì‚¬ì£¼ ê³„ì‚°
            const saju = calculator.calculateSaju(birthData);
            
            // ê²°ê³¼ í˜ì´ì§€ í‘œì‹œ
            showResult(birthData, saju);
        });

        // ê²°ê³¼ í˜ì´ì§€ í‘œì‹œ
        function showResult(birthData, saju) {
            // í˜ì´ì§€ ì „í™˜
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('resultPage').style.display = 'block';

            // ê°œì¸ ì •ë³´ í‘œì‹œ
            document.getElementById('personName').textContent = birthData.name + 'ë‹˜';
            
            const birthInfo = `
                ${birthData.year}ë…„ ${birthData.month}ì›” ${birthData.day}ì¼ 
                ${String(birthData.hour).padStart(2, '0')}:${String(birthData.minute).padStart(2, '0')} 
                (${birthData.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}, ${birthData.calendarType === 'solar' ? 'ì–‘ë ¥' : 'ìŒë ¥'})
            `;
            document.getElementById('birthInfo').textContent = birthInfo;

            // ì‚¬ì£¼ 8ê¸€ì í‘œì‹œ
            const pillars = [
                { title: 'ë…„ì£¼ (å¹´)', pillar: saju.year, info: `${saju.year.branch.animal}ë ` },
                { title: 'ì›”ì£¼ (æœˆ)', pillar: saju.month, info: `${saju.month.branch.time}` },
                { title: 'ì¼ì£¼ (æ—¥)', pillar: saju.day, info: 'ì¼ê°„ (ë³¸ì¸)' },
                { title: 'ì‹œì£¼ (æ™‚)', pillar: saju.time, info: `${saju.time.branch.time}` }
            ];

            const sajuHTML = pillars.map(item => `
                <div class="pillar">
                    <div class="pillar-title">${item.title}</div>
                    <div class="pillar-chinese">${item.pillar.chinese}</div>
                    <div class="pillar-korean">${item.pillar.korean}</div>
                    <div class="pillar-detail">
                        ${item.pillar.stem.element}${item.pillar.stem.yinyang} / ${item.pillar.branch.element}<br>
                        ${item.info}
                    </div>
                </div>
            `).join('');

            document.getElementById('sajuResult').innerHTML = sajuHTML;

            // ìš”ì•½ ì •ë³´ í‘œì‹œ
            const summaryHTML = `
                <div class="info-item">
                    <div class="info-label">ì¼ê°„ (ë³¸ì¸)</div>
                    <div class="info-value">${saju.day.stem.chinese} (${saju.day.stem.element}${saju.day.stem.yinyang})</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ë </div>
                    <div class="info-value">${saju.year.branch.animal}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ì¶œìƒ ê³„ì ˆ</div>
                    <div class="info-value">${getSeasonFromMonth(birthData.month)}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">í˜„ì¬ ë‚˜ì´</div>
                    <div class="info-value">${new Date().getFullYear() - birthData.year + 1}ì„¸</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ì‚¬ì£¼ 8ê¸€ì</div>
                    <div class="info-value">${saju.year.chinese}${saju.month.chinese}${saju.day.chinese}${saju.time.chinese}</div>
                </div>
            `;

            document.getElementById('summaryInfo').innerHTML = summaryHTML;
            document.getElementById('calculationTime').textContent = 
                `ê³„ì‚° ì™„ë£Œ: ${new Date().toLocaleString()}`;

            // ê²°ê³¼ í˜ì´ì§€ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo(0, 0);
        }

        // ê³„ì ˆ ê³„ì‚°
        function getSeasonFromMonth(month) {
            if (month >= 3 && month <= 5) return 'ë´„';
            if (month >= 6 && month <= 8) return 'ì—¬ë¦„';  
            if (month >= 9 && month <= 11) return 'ê°€ì„';
            return 'ê²¨ìš¸';
        }

        // ë’¤ë¡œ ê°€ê¸°
        function goBack() {
            document.getElementById('mainPage').style.display = 'flex';
            document.getElementById('resultPage').style.display = 'none';
        }

        // ê¸°ë³¸ê°’ ì„¤ì •
        window.addEventListener('load', function() {
            const today = new Date();
            document.getElementById('birthDate').valueAsDate = today;
        });
    </script>
</body>
</html>
