<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>정밀 만세력 - 사주 8글자</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* 메인 페이지 */
        .main-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .input-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 100%;
        }

        .title {
            text-align: center;
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 1rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        /* 결과 페이지 */
        .result-page {
            display: none;
            min-height: 100vh;
            padding: 2rem;
        }

        .result-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .saju-display {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .person-info {
            margin-bottom: 2rem;
            color: #333;
        }

        .person-info h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .birth-info {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
        }

        .saju-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .pillars-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin: 2rem 0;
        }

        .pillar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem 1rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .pillar:hover {
            transform: translateY(-5px);
        }

        .pillar-title {
            font-size: 1rem;
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .pillar-chinese {
            font-size: 3rem;
            font-weight: bold;
            margin: 0.5rem 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            line-height: 1;
        }

        .pillar-korean {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .pillar-detail {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .summary-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .summary-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 1rem;
            text-align: center;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .info-item {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .calculation-time {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .pillars-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }

            .pillar-chinese {
                font-size: 2.5rem;
            }

            .input-container {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- 메인 페이지 -->
    <div id="mainPage" class="main-page">
        <div class="input-container">
            <h1 class="title">🔮 만세력</h1>
            <p class="subtitle">정확한 사주 8글자를 확인하세요</p>
            
            <form id="sajuForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>이름</label>
                        <input type="text" id="name" value="홍길동" required>
                    </div>
                    <div class="form-group">
                        <label>성별</label>
                        <select id="gender" required>
                            <option value="male" selected>남자</option>
                            <option value="female">여자</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>생년월일</label>
                    <input type="date" id="birthDate" value="1990-05-15" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>달력 구분</label>
                        <select id="calendarType" required>
                            <option value="solar" selected>양력</option>
                            <option value="lunar">음력</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>출생 시간</label>
                        <input type="time" id="birthTime" value="14:30" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>출생 지역</label>
                    <select id="location">
                        <option value="seoul" selected>서울특별시</option>
                        <option value="busan">부산광역시</option>
                        <option value="daegu">대구광역시</option>
                        <option value="incheon">인천광역시</option>
                        <option value="gwangju">광주광역시</option>
                        <option value="daejeon">대전광역시</option>
                        <option value="ulsan">울산광역시</option>
                    </select>
                </div>
                
                <button type="submit" class="calculate-btn">
                    🧮 만세력 계산하기
                </button>
            </form>
        </div>
    </div>

    <!-- 결과 페이지 -->
    <div id="resultPage" class="result-page">
        <div class="result-container">
            <button class="back-btn" onclick="goBack()">← 다시 계산하기</button>
            
            <div class="header">
                <h1 id="resultTitle">사주명반</h1>
            </div>

            <div class="saju-display">
                <div class="person-info">
                    <h2 id="personName"></h2>
                    <div class="birth-info" id="birthInfo"></div>
                </div>

                <div class="saju-title">📊 사주 8글자</div>
                
                <div class="pillars-container" id="sajuResult">
                    <!-- 사주 결과가 여기에 표시됩니다 -->
                </div>

                <div class="summary-info">
                    <div class="summary-title">🌟 사주 정보</div>
                    <div class="info-grid" id="summaryInfo">
                        <!-- 요약 정보가 여기에 표시됩니다 -->
                    </div>
                </div>

                <div class="calculation-time" id="calculationTime">
                    <!-- 계산 시간이 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 정밀 만세력 계산 엔진
        class PreciseManseCalculator {
            constructor() {
                // 천간 10개
                this.heavenlyStems = [
                    { korean: '갑', chinese: '甲', element: '목', yinyang: '양' },
                    { korean: '을', chinese: '乙', element: '목', yinyang: '음' },
                    { korean: '병', chinese: '丙', element: '화', yinyang: '양' },
                    { korean: '정', chinese: '丁', element: '화', yinyang: '음' },
                    { korean: '무', chinese: '戊', element: '토', yinyang: '양' },
                    { korean: '기', chinese: '己', element: '토', yinyang: '음' },
                    { korean: '경', chinese: '庚', element: '금', yinyang: '양' },
                    { korean: '신', chinese: '辛', element: '금', yinyang: '음' },
                    { korean: '임', chinese: '壬', element: '수', yinyang: '양' },
                    { korean: '계', chinese: '癸', element: '수', yinyang: '음' }
                ];

                // 지지 12개
                this.earthlyBranches = [
                    { korean: '자', chinese: '子', animal: '쥐', time: '23-01시', element: '수' },
                    { korean: '축', chinese: '丑', animal: '소', time: '01-03시', element: '토' },
                    { korean: '인', chinese: '寅', animal: '호랑이', time: '03-05시', element: '목' },
                    { korean: '묘', chinese: '卯', animal: '토끼', time: '05-07시', element: '목' },
                    { korean: '진', chinese: '辰', animal: '용', time: '07-09시', element: '토' },
                    { korean: '사', chinese: '巳', animal: '뱀', time: '09-11시', element: '화' },
                    { korean: '오', chinese: '午', animal: '말', time: '11-13시', element: '화' },
                    { korean: '미', chinese: '未', animal: '양', time: '13-15시', element: '토' },
                    { korean: '신', chinese: '申', animal: '원숭이', time: '15-17시', element: '금' },
                    { korean: '유', chinese: '酉', animal: '닭', time: '17-19시', element: '금' },
                    { korean: '술', chinese: '戌', animal: '개', time: '19-21시', element: '토' },
                    { korean: '해', chinese: '亥', animal: '돼지', time: '21-23시', element: '수' }
                ];

                // 2025년 정확한 24절기 (한국천문연구원 기준)
                this.solarTerms2025 = {
                    소한: "2025-01-05 05:00",
                    대한: "2025-01-20 04:01",
                    입춘: "2025-02-03 22:10",
                    우수: "2025-02-18 12:33",
                    경칩: "2025-03-05 16:07",
                    춘분: "2025-03-20 15:01",
                    청명: "2025-04-04 21:48",
                    곡우: "2025-04-20 03:55",
                    입하: "2025-05-05 09:10",
                    소만: "2025-05-20 21:59",
                    망종: "2025-06-05 16:10",
                    하지: "2025-06-21 10:42",
                    소서: "2025-07-07 04:05",
                    대서: "2025-07-22 21:30",
                    입추: "2025-08-07 14:09",
                    처서: "2025-08-23 05:34",
                    백로: "2025-09-07 18:51",
                    추분: "2025-09-23 06:19",
                    한로: "2025-10-08 15:22",
                    상강: "2025-10-23 22:15",
                    입동: "2025-11-07 03:20",
                    소설: "2025-11-22 09:56",
                    대설: "2025-12-07 05:04",
                    동지: "2025-12-21 22:21"
                };
            }

            // 60갑자 계산
            calculate60Gapja(stemIndex, branchIndex) {
                const stem = this.heavenlyStems[stemIndex];
                const branch = this.earthlyBranches[branchIndex];
                return {
                    korean: stem.korean + branch.korean,
                    chinese: stem.chinese + branch.chinese,
                    stem: stem,
                    branch: branch
                };
            }

            // 정밀한 년주 계산 (입춘 기준)
            calculateYearPillar(year, month, day, hour, minute) {
                // 입춘 전인지 확인
                const inputDateTime = new Date(year, month - 1, day, hour, minute);
                const lichunStr = year === 2025 ? this.solarTerms2025.입춘 : `${year}-02-04 05:00`;
                const lichunDateTime = new Date(lichunStr);

                let sajuYear = year;
                if (inputDateTime < lichunDateTime) {
                    sajuYear = year - 1;
                }

                // 1984년 갑자년 기준으로 계산
                const baseYear = 1984;
                const yearDiff = sajuYear - baseYear;
                const stemIndex = ((yearDiff % 10) + 10) % 10;
                const branchIndex = ((yearDiff % 12) + 12) % 12;

                return this.calculate60Gapja(stemIndex, branchIndex);
            }

            // 정밀한 월주 계산 (절기 기준)
            calculateMonthPillar(year, month, day, yearStem) {
                // 절기 기준 월 계산
                let sajuMonth = month;
                
                // 간략화된 절기 계산 (실제로는 정확한 절기 데이터 사용)
                if (month === 1 && day < 6) sajuMonth = 12;
                else if (month === 2 && day < 4) sajuMonth = 1;
                else if (month === 3 && day < 6) sajuMonth = 2;
                else if (month === 4 && day < 5) sajuMonth = 3;
                else if (month === 5 && day < 6) sajuMonth = 4;
                else if (month === 6 && day < 6) sajuMonth = 5;
                else if (month === 7 && day < 7) sajuMonth = 6;
                else if (month === 8 && day < 8) sajuMonth = 7;
                else if (month === 9 && day < 8) sajuMonth = 8;
                else if (month === 10 && day < 9) sajuMonth = 9;
                else if (month === 11 && day < 8) sajuMonth = 10;
                else if (month === 12 && day < 7) sajuMonth = 11;

                // 갑기년, 을경년 등의 규칙 적용
                const yearStemIndex = this.heavenlyStems.findIndex(s => s.chinese === yearStem.chinese);
                let monthStemIndex;

                if (yearStemIndex === 0 || yearStemIndex === 5) { // 갑년, 기년
                    monthStemIndex = (sajuMonth + 1) % 10;
                } else if (yearStemIndex === 1 || yearStemIndex === 6) { // 을년, 경년
                    monthStemIndex = (sajuMonth + 3) % 10;
                } else if (yearStemIndex === 2 || yearStemIndex === 7) { // 병년, 신년
                    monthStemIndex = (sajuMonth + 5) % 10;
                } else if (yearStemIndex === 3 || yearStemIndex === 8) { // 정년, 임년
                    monthStemIndex = (sajuMonth + 7) % 10;
                } else { // 무년, 계년
                    monthStemIndex = (sajuMonth + 9) % 10;
                }

                const monthBranchIndex = (sajuMonth + 1) % 12;
                return this.calculate60Gapja(monthStemIndex, monthBranchIndex);
            }

            // 정밀한 일주 계산 (율리우스 적일)
            calculateDayPillar(year, month, day) {
                // 율리우스 적일 계산
                const a = Math.floor((14 - month) / 12);
                const y = year - a;
                const m = month + 12 * a - 3;
                
                const jd = day + Math.floor((153 * m + 2) / 5) + 365 * y + 
                          Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) + 1721119;

                // 갑자일 기준 (1984년 2월 2일)
                const baseJD = 2445370;
                const dayDiff = jd - baseJD;
                
                const stemIndex = ((dayDiff % 10) + 10) % 10;
                const branchIndex = ((dayDiff % 12) + 12) % 12;

                return this.calculate60Gapja(stemIndex, branchIndex);
            }

            // 정밀한 시주 계산
            calculateTimePillar(hour, minute, dayStem) {
                // 30분 경계 처리
                let timeHour = hour;
                if (minute >= 30) timeHour += 1;

                // 12지시 계산
                let branchIndex;
                if (timeHour >= 23 || timeHour < 1) branchIndex = 0;
                else if (timeHour >= 1 && timeHour < 3) branchIndex = 1;
                else if (timeHour >= 3 && timeHour < 5) branchIndex = 2;
                else if (timeHour >= 5 && timeHour < 7) branchIndex = 3;
                else if (timeHour >= 7 && timeHour < 9) branchIndex = 4;
                else if (timeHour >= 9 && timeHour < 11) branchIndex = 5;
                else if (timeHour >= 11 && timeHour < 13) branchIndex = 6;
                else if (timeHour >= 13 && timeHour < 15) branchIndex = 7;
                else if (timeHour >= 15 && timeHour < 17) branchIndex = 8;
                else if (timeHour >= 17 && timeHour < 19) branchIndex = 9;
                else if (timeHour >= 19 && timeHour < 21) branchIndex = 10;
                else branchIndex = 11;

                // 갑기일, 을경일 등의 규칙 적용
                const dayStemIndex = this.heavenlyStems.findIndex(s => s.chinese === dayStem.chinese);
                let timeStemIndex;

                if (dayStemIndex === 0 || dayStemIndex === 5) {
                    timeStemIndex = branchIndex % 10;
                } else if (dayStemIndex === 1 || dayStemIndex === 6) {
                    timeStemIndex = (branchIndex + 2) % 10;
                } else if (dayStemIndex === 2 || dayStemIndex === 7) {
                    timeStemIndex = (branchIndex + 4) % 10;
                } else if (dayStemIndex === 3 || dayStemIndex === 8) {
                    timeStemIndex = (branchIndex + 6) % 10;
                } else {
                    timeStemIndex = (branchIndex + 8) % 10;
                }

                return this.calculate60Gapja(timeStemIndex, branchIndex);
            }

            // 전체 사주 계산
            calculateSaju(birthData) {
                const { year, month, day, hour, minute } = birthData;

                const yearPillar = this.calculateYearPillar(year, month, day, hour, minute);
                const monthPillar = this.calculateMonthPillar(year, month, day, yearPillar.stem);
                const dayPillar = this.calculateDayPillar(year, month, day);
                const timePillar = this.calculateTimePillar(hour, minute, dayPillar.stem);

                return {
                    year: yearPillar,
                    month: monthPillar,
                    day: dayPillar,
                    time: timePillar
                };
            }
        }

        // 전역 변수
        const calculator = new PreciseManseCalculator();

        // 폼 제출 처리
        document.getElementById('sajuForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const gender = document.getElementById('gender').value;
            const birthDate = new Date(document.getElementById('birthDate').value);
            const birthTime = document.getElementById('birthTime').value;
            const calendarType = document.getElementById('calendarType').value;
            const location = document.getElementById('location').value;

            const [hour, minute] = birthTime.split(':').map(Number);

            const birthData = {
                name: name,
                gender: gender,
                year: birthDate.getFullYear(),
                month: birthDate.getMonth() + 1,
                day: birthDate.getDate(),
                hour: hour,
                minute: minute,
                calendarType: calendarType,
                location: location
            };

            // 사주 계산
            const saju = calculator.calculateSaju(birthData);
            
            // 결과 페이지 표시
            showResult(birthData, saju);
        });

        // 결과 페이지 표시
        function showResult(birthData, saju) {
            // 페이지 전환
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('resultPage').style.display = 'block';

            // 개인 정보 표시
            document.getElementById('personName').textContent = birthData.name + '님';
            
            const birthInfo = `
                ${birthData.year}년 ${birthData.month}월 ${birthData.day}일 
                ${String(birthData.hour).padStart(2, '0')}:${String(birthData.minute).padStart(2, '0')} 
                (${birthData.gender === 'male' ? '남성' : '여성'}, ${birthData.calendarType === 'solar' ? '양력' : '음력'})
            `;
            document.getElementById('birthInfo').textContent = birthInfo;

            // 사주 8글자 표시
            const pillars = [
                { title: '년주 (年)', pillar: saju.year, info: `${saju.year.branch.animal}띠` },
                { title: '월주 (月)', pillar: saju.month, info: `${saju.month.branch.time}` },
                { title: '일주 (日)', pillar: saju.day, info: '일간 (본인)' },
                { title: '시주 (時)', pillar: saju.time, info: `${saju.time.branch.time}` }
            ];

            const sajuHTML = pillars.map(item => `
                <div class="pillar">
                    <div class="pillar-title">${item.title}</div>
                    <div class="pillar-chinese">${item.pillar.chinese}</div>
                    <div class="pillar-korean">${item.pillar.korean}</div>
                    <div class="pillar-detail">
                        ${item.pillar.stem.element}${item.pillar.stem.yinyang} / ${item.pillar.branch.element}<br>
                        ${item.info}
                    </div>
                </div>
            `).join('');

            document.getElementById('sajuResult').innerHTML = sajuHTML;

            // 요약 정보 표시
            const summaryHTML = `
                <div class="info-item">
                    <div class="info-label">일간 (본인)</div>
                    <div class="info-value">${saju.day.stem.chinese} (${saju.day.stem.element}${saju.day.stem.yinyang})</div>
                </div>
                <div class="info-item">
                    <div class="info-label">띠</div>
                    <div class="info-value">${saju.year.branch.animal}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">출생 계절</div>
                    <div class="info-value">${getSeasonFromMonth(birthData.month)}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">현재 나이</div>
                    <div class="info-value">${new Date().getFullYear() - birthData.year + 1}세</div>
                </div>
                <div class="info-item">
                    <div class="info-label">사주 8글자</div>
                    <div class="info-value">${saju.year.chinese}${saju.month.chinese}${saju.day.chinese}${saju.time.chinese}</div>
                </div>
            `;

            document.getElementById('summaryInfo').innerHTML = summaryHTML;
            document.getElementById('calculationTime').textContent = 
                `계산 완료: ${new Date().toLocaleString()}`;

            // 결과 페이지로 스크롤
            window.scrollTo(0, 0);
        }

        // 계절 계산
        function getSeasonFromMonth(month) {
            if (month >= 3 && month <= 5) return '봄';
            if (month >= 6 && month <= 8) return '여름';  
            if (month >= 9 && month <= 11) return '가을';
            return '겨울';
        }

        // 뒤로 가기
        function goBack() {
            document.getElementById('mainPage').style.display = 'flex';
            document.getElementById('resultPage').style.display = 'none';
        }

        // 기본값 설정
        window.addEventListener('load', function() {
            const today = new Date();
            document.getElementById('birthDate').valueAsDate = today;
        });
    </script>
</body>
</html>